<MudCard Outlined="true" Elevation="5">
    <MudCardHeader>
        <MudText>@Title</MudText>
    </MudCardHeader>
    <MudCardContent>
        
        <MudGrid>
            <MudItem xs="12" sm="6" md="3">
                <MudCard Outlined="true">
                    <MudCardContent>
                        <MudStack Spacing="1">
                            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                                <MudIcon Icon="@Icons.Material.Filled.TrendingUp" Size="Size.Small" Color="Color.Success"></MudIcon>
                                <MudText Typo="Typo.caption">Total In</MudText>
                            </MudStack>
                            <MudText Typo="Typo.h6" Color="Color.Success">@TotalIn.ToString("C")</MudText>
                            @if (PerDayAverageIn.HasValue && DaysInPeriod > 0)
                            {
                                <MudText Typo="Typo.caption">Avg/day: @PerDayAverageIn.Value.ToString("C")</MudText>
                            }
                        </MudStack>
                    </MudCardContent>
                </MudCard>
            </MudItem>
            
            <MudItem xs="12" sm="6" md="3">
                <MudCard Outlined="true">
                    <MudCardContent>
                        <MudStack Spacing="1">
                            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                                <MudIcon Icon="@Icons.Material.Filled.TrendingDown" Size="Size.Small" Color="Color.Error"></MudIcon>
                                <MudText Typo="Typo.caption">Total Out</MudText>
                            </MudStack>
                            <MudText Typo="Typo.h6" Color="Color.Error">@TotalOut.ToString("C")</MudText>
                            @if (PerDayAverageOut.HasValue && DaysInPeriod > 0)
                            {
                                <MudText Typo="Typo.caption">Avg/day: @PerDayAverageOut.Value.ToString("C")</MudText>
                            }
                        </MudStack>
                    </MudCardContent>
                </MudCard>
            </MudItem>
            
            <MudItem xs="12" sm="6" md="3">
                <MudCard Outlined="true">
                    <MudCardContent>
                        <MudStack Spacing="1">
                            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                                <MudIcon Icon="@Icons.Material.Filled.Calculate" Size="Size.Small" Color="Color.Tertiary"></MudIcon>
                                <MudText Typo="Typo.caption">Difference</MudText>
                            </MudStack>
                            <MudText Typo="Typo.h6" Color="Color.Tertiary">@Normalised.ToString("C")</MudText>
                        </MudStack>
                    </MudCardContent>
                </MudCard>
            </MudItem>

            <MudItem xs="12" sm="6" md="3">
                <MudCard Outlined="true">
                    <MudCardContent>
                        <MudStack Spacing="1">
                            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                                <MudIcon Icon="@GetTrendIcon()" Size="Size.Small" Color="@GetTrendColor()"></MudIcon>
                                <MudText Typo="Typo.caption">Trend</MudText>
                            </MudStack>
                            @{
                                var trendColor = GetTrendColor();
                                var trendIndicator = GetTrendIndicator();
                            }
                            <MudText Typo="Typo.h6" Color="@GetTrendColor()">@trendIndicator</MudText>
                            @if (TrendPercentage.HasValue)
                            {
                                <MudText Typo="Typo.caption" Color="Color.Tertiary">@TrendPercentage.Value.ToString("P2")</MudText>
                            }
                        </MudStack>
                    </MudCardContent>
                </MudCard>
            </MudItem>
        </MudGrid>
        
    </MudCardContent>
</MudCard>

@code{

    [Parameter, EditorRequired]
    public string Title { get; set; }

    [Parameter, EditorRequired]
    public decimal TotalIn { get; set; }

    [Parameter, EditorRequired]
    public decimal TotalOut { get; set; }

    [Parameter, EditorRequired]
    public decimal Normalised { get; set; }

    [Parameter]
    public decimal? PerDayAverageIn { get; set; }

    [Parameter]
    public decimal? PerDayAverageOut { get; set; }

    [Parameter]
    public int DaysInPeriod { get; set; }

    [Parameter]
    public decimal? TrendValue { get; set; }

    [Parameter]
    public decimal? TrendPercentage { get; set; }

    private string GetTrendIcon()
    {
        if (TrendValue == null)
            return Icons.Material.Filled.Remove;

        return TrendValue > 0 
            ? Icons.Material.Filled.TrendingUp 
            : Icons.Material.Filled.TrendingDown;
    }

    private string GetTrendIndicator()
    {
        if (TrendValue == null)
            return "N/A";

        return TrendValue > 0 ? "? Increased" : "? Decreased";
    }

    private Color GetTrendColor()
    {

        if (TrendValue == null)
            return Color.Primary;

        return TrendValue > 0 
            ? Color.Error
            : Color.Success;
    }
}